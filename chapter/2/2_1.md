# 演習問題 2.1
## 問題
トークンのワンホット表現について、2つのトークンの距離が等しくならないような距離を考えてみよ

## 前提知識
### ワンホット表現
語彙の集合を $V$ とする。語彙の要素数を $|V|$ で表す。

ある語彙 $v \in V$ に対応するワンホット表現 $l_v$ とは、 $v$ に対応する次元の要素を 1, それ以外の要素を 0 とした $|V|$ 次元のベクトルである。

例えば、 $V = \lbrace \rm{apple}, \rm{banana}, \rm{cat} \rbrace$ とすると、ワンホット表現
$l_{\rm{apple}} = (1, 0, 0)^\top, l_{\rm{banana}} = (0, 1, 0)^\top, l_{\rm{cat}} = (0, 0, 1)^\top$ となる。

## 解答
1の出現位置の関係性によって、計算される距離の値が変動するようにしなければならない。であれば、次元ごとに異なる重みをもたせるのが良いだろう。

半正定値対称行列 $A \in \mathbb{R}^{|V|\times|V|}$ を係数に持つ二次形式による距離を考えてみる。

$v, w \in V$ のワンホット表現 $l_v, l_w \in \mathbb{R}^{|V|}$ についての行列 $A$ による重み付き距離 $d_A(l_v, l_w)$ を

$$
d_A(l_v, l_w) = \sqrt { (l_v-l_w)^\top A(l_v-l_w) }
$$

で定める。具体的に、

$$
A = 
\begin{pmatrix}
1 & 1/3 & 0 \\
1/3 & 1 & 1/3 \\
0 & 1/3 & 1 \\
\end{pmatrix}
$$

とすると、

$$
d_A((1, 0, 0)^\top, (0, 1, 0)^\top) = \sqrt { \begin{pmatrix}
1 & -1 & 0 \end{pmatrix}
 \begin{pmatrix}
1 & 1/3 & 0 \\
1/3 & 1 & 1/3 \\
0 & 1/3 & 1 \\
\end{pmatrix}
\begin{pmatrix}
1 \\
-1 \\
0 \\
\end{pmatrix} } = \sqrt {\frac{4}{3} }
$$
$$
d_A((1, 0, 0)^\top, (0, 0, 1)^\top) = \sqrt{ \begin{pmatrix}
1 & 0 & -1 \end{pmatrix}
 \begin{pmatrix}
1 & 1/3 & 0 \\
1/3 & 1 & 1/3 \\
0 & 1/3 & 1 \\
\end{pmatrix}
\begin{pmatrix}
1 \\
0 \\
-1 \\
\end{pmatrix} }= \sqrt{2}
$$

となり、異なるワンホット表現の組の距離が必ず一定になるとは限らないことがわかる。

## 補足
### 正定値性について
$d_A(l_v, l_w)$ が距離の公理を満たすために、 $A$ が正定値行列、つまり任意の $|V|$ 次元実ベクトル $x$ ($\neq 0$) について、

$$
  x^\top Ax > 0
$$

を満たす必要がある。

正定値性には同値な定義がいくつかあり、そのいずれかによって正定値行列であるかどうかを確かめることができる。例えば、行列Aが正定値であることは、その行列の固有値が全て正であることと同値である。

解答で与えた $A$ について実際に固有値 $\lambda_1, \lambda_2, \lambda_3$ を求めると $\lambda_1 = 1, \lambda_2 = \frac{3-\sqrt{2}}{3} = 0.5285954792\cdots, \lambda_3 = \frac{3+\sqrt{2}}{3} = 1.47140452079\cdots$ となり、すべて正であることから、 $A$ は正定値行列であることがわかる。

他にも例えばシルベスタの判定法による方法もある。

### ユークリッド距離との関係性について
通常のユークリッド距離 $d(l_v, l_w) = \| l_v - l_w \| = \sqrt{ (l_v - l_w)^\top (l_v - l_w) }$ は、 $d_A(l_v, l_w)$ において、

$$
A = 
\begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1 \\
\end{pmatrix}
$$

としたものに他ならない。つまり $d_A(l_v, l_w)$ はユークリッド距離の拡張となっている。

## 参考文献
金谷 健一,「これなら分かる最適化数学」共立出版, 2005
